<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Portal</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        @keyframes jiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .shake:hover {
            animation: jiggle 0.4s ease-in-out;
        }

        .float-wave:nth-child(1) {
            animation: float 3s ease-in-out infinite;
            animation-delay: 0s;
        }

        .float-wave:nth-child(2) {
            animation: float 3s ease-in-out infinite;
            animation-delay: 0.3s;
        }

        .float-wave:nth-child(3) {
            animation: float 3s ease-in-out infinite;
            animation-delay: 0.6s;
        }

        .hover-stop:hover {
            animation: none;
        }

        .hover-stop:hover {
            animation: jiggle 0.4s ease-in-out;
        }

        .space-gas-bg {
            position: relative;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        #backgroundVideo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -1;
            object-fit: cover;
        }

        #transitionVideo {
            display: none;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        #transitionVideo.visible {
            display: block;
            opacity: 1;
        }

        #coinLogo {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 128px;
            height: 128px;
            animation: spin 3s linear infinite;
            z-index: 100;
        }
    </style>
</head>
<body class="overflow-auto font-sans space-gas-bg text-white relative">

    <!-- Spinning Coin Logo -->
    <img id="coinLogo" src="PortalLogo.png" alt="Spinning Coin Logo">

    <!-- Background Video -->
    <video id="backgroundVideo" autoplay muted loop>
        <source src="StarsLoop.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Transition Video -->
    <video id="transitionVideo" class="absolute top-0 left-0 w-full h-full object-cover z-50" muted playsinline preload="auto">
        <source src="TestOverlay.webm" type="video/webm">
        Your browser does not support the video tag.
    </video>

    <div id="mainContent" class="relative min-h-screen flex items-center justify-center">
        <div class="relative z-10 flex flex-col items-center justify-center text-center">
            <img id="logo" src="TimePortal.gif" alt="Time Portal Logo" class="mb-4 fade-in" width="1000">
            <p id="enterDateText" class="text-lg text-gray-300 mb-6 fade-in">Enter The Date</p>

            <div id="dateInputContainer" class="flex space-x-4 justify-center mb-8 fade-in">
                <input type="date" id="dateInput" class="px-4 py-2 rounded-lg border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 text-gray-800">
                <button id="startButton" onclick="fetchYouTubeVideo()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md">
                    Generate
                </button>
            </div>

            <div id="output" class="w-10/12 fade-in"></div>

            <button id="resetButton" onclick="resetPage()" class="bg-blue-500 text-white px-6 py-2 rounded-lg shadow-md mt-6 hidden">
                Back
            </button>

            <div id="socialLinks" class="flex space-x-4 justify-center mt-8 fade-in">
                <a href="https://twitter.com" target="_blank" class="float-wave hover-stop">
                    <img src="TwitterPng.png" alt="Twitter Logo" class="w-8 h-8">
                </a>
                <a href="https://instagram.com" target="_blank" class="float-wave hover-stop">
                    <img src="IGPng.png" alt="Instagram Logo" class="w-8 h-8">
                </a>
                <a href="https://photon.com" target="_blank" class="float-wave hover-stop">
                    <img src="PhotonPng.png" alt="Photon Logo" class="w-8 h-8">
                </a>
            </div>
        </div>
    </div>

    <script>
        const apiKey = 'AIzaSyDK3Flc8ZqeKX7nLAEO6-eHPgRqru3GO-c';

        async function fetchYouTubeVideo() {
            const dateInput = document.getElementById('dateInput').value;
            const output = document.getElementById('output');
            const transitionVideo = document.getElementById('transitionVideo');
            const logo = document.getElementById('logo');
            const enterDateText = document.getElementById('enterDateText');
            const dateInputContainer = document.getElementById('dateInputContainer');
            const resetButton = document.getElementById('resetButton');
            const socialLinks = document.getElementById('socialLinks');

            if (!/^\d{4}-\d{2}-\d{2}$/.test(dateInput)) {
                output.textContent = "Please enter a valid date!";
                return;
            }

            // Hide initial elements
            logo.classList.add('hidden');
            enterDateText.classList.add('hidden');
            dateInputContainer.classList.add('hidden');
            socialLinks.classList.add('hidden');

            // Play transition effect
            transitionVideo.classList.add('visible');
            transitionVideo.play();

            setTimeout(async () => {
                transitionVideo.classList.remove('visible');
                const [year] = dateInput.split("-");

                try {
                    const searchQuery = 'classic YouTube memes';
                    const apiUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(searchQuery)}&key=${apiKey}&maxResults=1&type=video&order=date&publishedBefore=${year}-12-31T23:59:59Z`;

                    const response = await fetch(apiUrl);
                    const data = await response.json();

                    if (data.items && data.items.length > 0) {
                        const video = data.items[0];
                        const videoId = video.id.videoId;

                        const videoDetailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=${videoId}&key=${apiKey}`;
                        const videoDetailsResponse = await fetch(videoDetailsUrl);
                        const videoDetailsData = await videoDetailsResponse.json();
                        const videoDetails = videoDetailsData.items[0];

                        const channelId = videoDetails.snippet.channelId;
                        const channelDetailsUrl = `https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${apiKey}`;
                        const channelDetailsResponse = await fetch(channelDetailsUrl);
                        const channelDetailsData = await channelDetailsResponse.json();
                        const channelStats = channelDetailsData.items[0].statistics;

                        const title = videoDetails.snippet.title;
                        const publishDate = new Date(videoDetails.snippet.publishedAt).toDateString();
                        const views = parseInt(videoDetails.statistics.viewCount).toLocaleString();
                        const duration = videoDetails.contentDetails.duration.replace("PT", "").toLowerCase();
                        const videoCount = parseInt(channelStats.videoCount).toLocaleString();

                        const fact = `
                            <p><strong>Title:</strong> ${title}</p>
                            <p><strong>Published:</strong> ${publishDate}</p>
                            <p><strong>Views:</strong> ${views} views</p>
                            <p><strong>Duration:</strong> Approximately ${duration}</p>
                            <p><strong>Total Videos by Channel:</strong> ${videoCount}</p>
                        `;

                        output.innerHTML = `
                            <div class="flex flex-col items-center">
                                <h3 class="text-lg font-bold mb-4">${title}</h3>
                                <iframe width="560" height="315" 
                                    src="https://www.youtube.com/embed/${videoId}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                                <div class="mt-4 bg-gray-900 p-4 rounded-lg text-gray-200 text-sm">
                                    ${fact}
                                </div>
                            </div>
                        `;
                    } else {
                        output.textContent = "No videos found for the selected date.";
                    }
                } catch (error) {
                    console.error(error);
                    output.textContent = "Failed to fetch data. Please try again later.";
                }

                resetButton.classList.remove('hidden');
            }, 4000);
        }

        function resetPage() {
            const transitionVideo = document.getElementById('transitionVideo');
            transitionVideo.classList.add('visible');
            transitionVideo.play();

            setTimeout(() => {
                transitionVideo.classList.remove('visible');
                location.reload();
            }, 4000);
        }
    </script>
</body>
</html>
